/*
name: qr-code-and-vcard
version: 0.9.2
author: Konstantin Nizhinskiy <konstantin.nizhinskiy@gmail.com>
date: 2018-05-14 15:05:04 

*/
!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.qrCode=b()}):"object"==typeof module&&module.exports?module.exports=a.qrCode=b():a.qrCode=b()}(this,function(){function a(a,b,c){var e="";return(b.details.label||b.details.street||b.details.city||b.details.stateProvince||b.details.postalCode||b.details.countryRegion)&&(c>=4?e="ADR"+a+";TYPE="+b.type+(b.details.label?';LABEL="'+d(b.details.label)+'"':"")+":;;"+d(b.details.street)+";"+d(b.details.city)+";"+d(b.details.stateProvince)+";"+d(b.details.postalCode)+";"+d(b.details.countryRegion)+g():(b.details.label&&(e="LABEL"+a+";TYPE="+b.type+":"+d(b.details.label)+g()),e+="ADR"+a+";TYPE="+b.type+":;;"+d(b.details.street)+";"+d(b.details.city)+";"+d(b.details.stateProvince)+";"+d(b.details.postalCode)+";"+d(b.details.countryRegion)+g())),e}function b(a,b){switch(a.toLowerCase()){case"facebook":return"https://facebook.com/"+b;case"linkedin":return"https://linkedin.com/"+b;case"twitter":return"https://twitter.com/"+b;case"flickr":return"https://flickr.com/"+b;case"skype":return"x-apple:"+b;default:return"https://www."+a+".com/"}}var c=function(){},d=function(a){return a?("string"!=typeof a&&(a=""+a),a.replace(/\n/g,"\\n").replace(/,/g,"\\,").replace(/;/g,"\\;")):""},e=function(a,b,c,e,f){var h;return h=f>=4?e?";ENCODING=b;MEDIATYPE=image/":";MEDIATYPE=image/":3===f?e?";ENCODING=b;TYPE=":";TYPE=":e?";ENCODING=BASE64;":";",a+h+c+":"+d(b)+g()},f=function(a){var b=a?a.split(".")[0]:"4";return isNaN(b)?4:parseInt(b)},g=function(){return"\r\n"},h=function(){function a(b,c){if(void 0===b.length)throw new Error(b.length+"/"+c);var d=function(){for(var a=0;a<b.length&&0==b[a];)a+=1;for(var d=new Array(b.length-a+c),e=0;e<b.length-a;e+=1)d[e]=b[e+a];return d}(),e={};return e.getAt=function(a){return d[a]},e.getLength=function(){return d.length},e.multiply=function(b){for(var c=new Array(e.getLength()+b.getLength()-1),d=0;d<e.getLength();d+=1)for(var f=0;f<b.getLength();f+=1)c[d+f]^=g.gexp(g.glog(e.getAt(d))+g.glog(b.getAt(f)));return a(c,0)},e.mod=function(b){if(e.getLength()-b.getLength()<0)return e;for(var c=g.glog(e.getAt(0))-g.glog(b.getAt(0)),d=new Array(e.getLength()),f=0;f<e.getLength();f+=1)d[f]=e.getAt(f);for(var f=0;f<b.getLength();f+=1)d[f]^=g.gexp(g.glog(b.getAt(f))+c);return a(d,0).mod(b)},e}var b=function(b,c){var e=236,g=17,n=b,o=d[c],p=null,q=0,s=null,t=new Array,u={},v=function(a,b){q=4*n+17,p=function(a){for(var b=new Array(a),c=0;c<a;c+=1){b[c]=new Array(a);for(var d=0;d<a;d+=1)b[c][d]=null}return b}(q),w(0,0),w(q-7,0),w(0,q-7),z(),y(),B(a,b),n>=7&&A(a),null==s&&(s=E(n,o,t)),C(s,b)},w=function(a,b){for(var c=-1;c<=7;c+=1)if(!(a+c<=-1||q<=a+c))for(var d=-1;d<=7;d+=1)b+d<=-1||q<=b+d||(p[a+c][b+d]=0<=c&&c<=6&&(0==d||6==d)||0<=d&&d<=6&&(0==c||6==c)||2<=c&&c<=4&&2<=d&&d<=4)},x=function(){for(var a=0,b=0,c=0;c<8;c+=1){v(!0,c);var d=f.getLostPoint(u);(0==c||a>d)&&(a=d,b=c)}return b},y=function(){for(var a=8;a<q-8;a+=1)null==p[a][6]&&(p[a][6]=a%2==0);for(var b=8;b<q-8;b+=1)null==p[6][b]&&(p[6][b]=b%2==0)},z=function(){for(var a=f.getPatternPosition(n),b=0;b<a.length;b+=1)for(var c=0;c<a.length;c+=1){var d=a[b],e=a[c];if(null==p[d][e])for(var g=-2;g<=2;g+=1)for(var h=-2;h<=2;h+=1)p[d+g][e+h]=-2==g||2==g||-2==h||2==h||0==g&&0==h}},A=function(a){for(var b=f.getBCHTypeNumber(n),c=0;c<18;c+=1){var d=!a&&1==(b>>c&1);p[Math.floor(c/3)][c%3+q-8-3]=d}for(var c=0;c<18;c+=1){var d=!a&&1==(b>>c&1);p[c%3+q-8-3][Math.floor(c/3)]=d}},B=function(a,b){for(var c=o<<3|b,d=f.getBCHTypeInfo(c),e=0;e<15;e+=1){var g=!a&&1==(d>>e&1);e<6?p[e][8]=g:e<8?p[e+1][8]=g:p[q-15+e][8]=g}for(var e=0;e<15;e+=1){var g=!a&&1==(d>>e&1);e<8?p[8][q-e-1]=g:e<9?p[8][15-e-1+1]=g:p[8][15-e-1]=g}p[q-8][8]=!a},C=function(a,b){for(var c=-1,d=q-1,e=7,g=0,h=f.getMaskFunction(b),i=q-1;i>0;i-=2)for(6==i&&(i-=1);;){for(var j=0;j<2;j+=1)if(null==p[d][i-j]){var k=!1;g<a.length&&(k=1==(a[g]>>>e&1));var l=h(d,i-j);l&&(k=!k),p[d][i-j]=k,e-=1,-1==e&&(g+=1,e=7)}if((d+=c)<0||q<=d){d-=c,c=-c;break}}},D=function(b,c){for(var d=0,e=0,g=0,h=new Array(c.length),i=new Array(c.length),j=0;j<c.length;j+=1){var k=c[j].dataCount,l=c[j].totalCount-k;e=Math.max(e,k),g=Math.max(g,l),h[j]=new Array(k);for(var m=0;m<h[j].length;m+=1)h[j][m]=255&b.getBuffer()[m+d];d+=k;var n=f.getErrorCorrectPolynomial(l),o=a(h[j],n.getLength()-1),p=o.mod(n);i[j]=new Array(n.getLength()-1);for(var m=0;m<i[j].length;m+=1){var q=m+p.getLength()-i[j].length;i[j][m]=q>=0?p.getAt(q):0}}for(var r=0,m=0;m<c.length;m+=1)r+=c[m].totalCount;for(var s=new Array(r),t=0,m=0;m<e;m+=1)for(var j=0;j<c.length;j+=1)m<h[j].length&&(s[t]=h[j][m],t+=1);for(var m=0;m<g;m+=1)for(var j=0;j<c.length;j+=1)m<i[j].length&&(s[t]=i[j][m],t+=1);return s},E=function(a,b,c){for(var d=h.getRSBlocks(a,b),j=i(),k=0;k<c.length;k+=1){var l=c[k];j.put(l.getMode(),4),j.put(l.getLength(),f.getLengthInBits(l.getMode(),a)),l.write(j)}for(var m=0,k=0;k<d.length;k+=1)m+=d[k].dataCount;if(j.getLengthInBits()>8*m)throw new Error("code length overflow. ("+j.getLengthInBits()+">"+8*m+")");for(j.getLengthInBits()+4<=8*m&&j.put(0,4);j.getLengthInBits()%8!=0;)j.putBit(!1);for(;;){if(j.getLengthInBits()>=8*m)break;if(j.put(e,8),j.getLengthInBits()>=8*m)break;j.put(g,8)}return D(j,d)};return u.addData=function(a,b){b=b||"Byte";var c=null;switch(b){case"Numeric":c=j(a);break;case"Alphanumeric":c=k(a);break;case"Byte":c=l(a);break;case"Kanji":c=m(a);break;default:throw"mode:"+b}t.push(c),s=null},u.isDark=function(a,b){if(a<0||q<=a||b<0||q<=b)throw new Error(a+","+b);return p[a][b]},u.getModuleCount=function(){return q},u.make=function(){v(!1,x())},u.createTableTag=function(a,b){a=a||2,b=void 0===b?4*a:b;var c="";c+='<table style="',c+=" border-width: 0px; border-style: none;",c+=" border-collapse: collapse;",c+=" padding: 0px; margin: "+b+"px;",c+='">',c+="<tbody>";for(var d=0;d<u.getModuleCount();d+=1){c+="<tr>";for(var e=0;e<u.getModuleCount();e+=1)c+='<td style="',c+=" border-width: 0px; border-style: none;",c+=" border-collapse: collapse;",c+=" padding: 0px; margin: 0px;",c+=" width: "+a+"px;",c+=" height: "+a+"px;",c+=" background-color: ",c+=u.isDark(d,e)?"#000000":"#ffffff",c+=";",c+='"/>';c+="</tr>"}return c+="</tbody>",c+="</table>"},u.createSvgTag=function(a,b){a=a||2,b=void 0===b?4*a:b;var c,d,e,f,g,h=u.getModuleCount()*a+2*b,i="";for(g="l"+a+",0 0,"+a+" -"+a+",0 0,-"+a+"z ",i+="<svg",i+=' width="'+h+'px"',i+=' height="'+h+'px"',i+=' xmlns="http://www.w3.org/2000/svg"',i+=">",i+='<path d="',e=0;e<u.getModuleCount();e+=1)for(f=e*a+b,c=0;c<u.getModuleCount();c+=1)u.isDark(e,c)&&(d=c*a+b,i+="M"+d+","+f+g);return i+='" stroke="transparent" fill="black"/>',i+="</svg>"},u.createImgTag=function(a,b){a=a||2,b=void 0===b?4*a:b;var c=u.getModuleCount()*a+2*b,d=b,e=c-b;return r(c,c,function(b,c){if(d<=b&&b<e&&d<=c&&c<e){var f=Math.floor((b-d)/a),g=Math.floor((c-d)/a);return u.isDark(g,f)?0:1}return 1})},u};b.stringToBytes=function(a){function b(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);d<128?b.push(d):d<2048?b.push(192|d>>6,128|63&d):d<55296||d>=57344?b.push(224|d>>12,128|d>>6&63,128|63&d):(c++,d=65536+((1023&d)<<10|1023&a.charCodeAt(c)),b.push(240|d>>18,128|d>>12&63,128|d>>6&63,128|63&d))}return b}return b(a)},b.createStringToBytes=function(a,b){var c=function(){for(var c=p(a),d=function(){var a=c.read();if(-1==a)throw new Error;return a},e=0,f={};;){var g=c.read();if(-1==g)break;var h=d(),i=d(),j=d(),k=String.fromCharCode(g<<8|h),l=i<<8|j;f[k]=l,e+=1}if(e!=b)throw new Error(e+" != "+b);return f}(),d="?".charCodeAt(0);return function(a){for(var b=new Array,e=0;e<a.length;e+=1){var f=a.charCodeAt(e);if(f<128)b.push(f);else{var g=c[a.charAt(e)];"number"==typeof g?(255&g)==g?b.push(g):(b.push(g>>>8),b.push(255&g)):b.push(d)}}return b}};var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},d={L:1,M:0,Q:3,H:2},e={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f=function(){var b=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],d=1335,f=7973,h={},i=function(a){for(var b=0;0!=a;)b+=1,a>>>=1;return b};return h.getBCHTypeInfo=function(a){for(var b=a<<10;i(b)-i(d)>=0;)b^=d<<i(b)-i(d);return 21522^(a<<10|b)},h.getBCHTypeNumber=function(a){for(var b=a<<12;i(b)-i(f)>=0;)b^=f<<i(b)-i(f);return a<<12|b},h.getPatternPosition=function(a){return b[a-1]},h.getMaskFunction=function(a){switch(a){case e.PATTERN000:return function(a,b){return(a+b)%2==0};case e.PATTERN001:return function(a,b){return a%2==0};case e.PATTERN010:return function(a,b){return b%3==0};case e.PATTERN011:return function(a,b){return(a+b)%3==0};case e.PATTERN100:return function(a,b){return(Math.floor(a/2)+Math.floor(b/3))%2==0};case e.PATTERN101:return function(a,b){return a*b%2+a*b%3==0};case e.PATTERN110:return function(a,b){return(a*b%2+a*b%3)%2==0};case e.PATTERN111:return function(a,b){return(a*b%3+(a+b)%2)%2==0};default:throw new Error("bad maskPattern:"+a)}},h.getErrorCorrectPolynomial=function(b){for(var c=a([1],0),d=0;d<b;d+=1)c=c.multiply(a([1,g.gexp(d)],0));return c},h.getLengthInBits=function(a,b){if(1<=b&&b<10)switch(a){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:case c.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(b<27)switch(a){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else{if(!(b<41))throw new Error("type:"+b);switch(a){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}}},h.getLostPoint=function(a){for(var b=a.getModuleCount(),c=0,d=0;d<b;d+=1)for(var e=0;e<b;e+=1){for(var f=0,g=a.isDark(d,e),h=-1;h<=1;h+=1)if(!(d+h<0||b<=d+h))for(var i=-1;i<=1;i+=1)e+i<0||b<=e+i||0==h&&0==i||g==a.isDark(d+h,e+i)&&(f+=1);f>5&&(c+=3+f-5)}for(var d=0;d<b-1;d+=1)for(var e=0;e<b-1;e+=1){var j=0;a.isDark(d,e)&&(j+=1),a.isDark(d+1,e)&&(j+=1),a.isDark(d,e+1)&&(j+=1),a.isDark(d+1,e+1)&&(j+=1),0!=j&&4!=j||(c+=3)}for(var d=0;d<b;d+=1)for(var e=0;e<b-6;e+=1)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(var e=0;e<b;e+=1)for(var d=0;d<b-6;d+=1)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(var k=0,e=0;e<b;e+=1)for(var d=0;d<b;d+=1)a.isDark(d,e)&&(k+=1);return c+=Math.abs(100*k/b/b-50)/5*10},h}(),g=function(){for(var a=new Array(256),b=new Array(256),c=0;c<8;c+=1)a[c]=1<<c;for(var c=8;c<256;c+=1)a[c]=a[c-4]^a[c-5]^a[c-6]^a[c-8];for(var c=0;c<255;c+=1)b[a[c]]=c;var d={};return d.glog=function(a){if(a<1)throw new Error("glog("+a+")");return b[a]},d.gexp=function(b){for(;b<0;)b+=255;for(;b>=256;)b-=255;return a[b]},d}(),h=function(){var a=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],b=function(a,b){var c={};return c.totalCount=a,c.dataCount=b,c},c={},e=function(b,c){switch(c){case d.L:return a[4*(b-1)+0];case d.M:return a[4*(b-1)+1];case d.Q:return a[4*(b-1)+2];case d.H:return a[4*(b-1)+3];default:return}};return c.getRSBlocks=function(a,c){var d=e(a,c);if(void 0===d)throw new Error("bad rs block @ typeNumber:"+a+"/errorCorrectionLevel:"+c);for(var f=d.length/3,g=new Array,h=0;h<f;h+=1)for(var i=d[3*h+0],j=d[3*h+1],k=d[3*h+2],l=0;l<i;l+=1)g.push(b(j,k));return g},c}(),i=function(){var a=new Array,b=0,c={};return c.getBuffer=function(){return a},c.getAt=function(b){var c=Math.floor(b/8);return 1==(a[c]>>>7-b%8&1)},c.put=function(a,b){for(var d=0;d<b;d+=1)c.putBit(1==(a>>>b-d-1&1))},c.getLengthInBits=function(){return b},c.putBit=function(c){var d=Math.floor(b/8);a.length<=d&&a.push(0),c&&(a[d]|=128>>>b%8),b+=1},c},j=function(a){var b=c.MODE_NUMBER,d=a,e={};e.getMode=function(){return b},e.getLength=function(a){return d.length},e.write=function(a){for(var b=d,c=0;c+2<b.length;)a.put(f(b.substring(c,c+3)),10),c+=3;c<b.length&&(b.length-c==1?a.put(f(b.substring(c,c+1)),4):b.length-c==2&&a.put(f(b.substring(c,c+2)),7))};var f=function(a){for(var b=0,c=0;c<a.length;c+=1)b=10*b+g(a.charAt(c));return b},g=function(a){if("0"<=a&&a<="9")return a.charCodeAt(0)-"0".charCodeAt(0);throw"illegal char :"+a};return e},k=function(a){var b=c.MODE_ALPHA_NUM,d=a,e={};e.getMode=function(){return b},e.getLength=function(a){return d.length},e.write=function(a){for(var b=d,c=0;c+1<b.length;)a.put(45*f(b.charAt(c))+f(b.charAt(c+1)),11),c+=2;c<b.length&&a.put(f(b.charAt(c)),6)};var f=function(a){if("0"<=a&&a<="9")return a.charCodeAt(0)-"0".charCodeAt(0);if("A"<=a&&a<="Z")return a.charCodeAt(0)-"A".charCodeAt(0)+10;switch(a){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+a}};return e},l=function(a){var d=c.MODE_8BIT_BYTE,e=b.stringToBytes(a),f={};return f.getMode=function(){return d},f.getLength=function(a){return e.length},f.write=function(a){for(var b=0;b<e.length;b+=1)a.put(e[b],8)},f},m=function(a){var d=c.MODE_KANJI,e=b.stringToBytes(a);!function(a,c){var d=b.stringToBytes(a);if(2!=d.length||(d[0]<<8|d[1])!=c)throw"sjis not supported."}("友",38726);var f={};return f.getMode=function(){return d},f.getLength=function(a){return~~(e.length/2)},f.write=function(a){for(var b=e,c=0;c+1<b.length;){var d=(255&b[c])<<8|255&b[c+1];if(33088<=d&&d<=40956)d-=33088;else{if(!(57408<=d&&d<=60351))throw"illegal char at "+(c+1)+"/"+d;d-=49472}d=192*(d>>>8&255)+(255&d),a.put(d,13),c+=2}if(c<b.length)throw"illegal char at "+(c+1)},f},n=function(){var a=new Array,b={};return b.writeByte=function(b){a.push(255&b)},b.writeShort=function(a){b.writeByte(a),b.writeByte(a>>>8)},b.writeBytes=function(a,c,d){c=c||0,d=d||a.length;for(var e=0;e<d;e+=1)b.writeByte(a[e+c])},b.writeString=function(a){for(var c=0;c<a.length;c+=1)b.writeByte(a.charCodeAt(c))},b.toByteArray=function(){return a},b.toString=function(){var b="";b+="[";for(var c=0;c<a.length;c+=1)c>0&&(b+=","),b+=a[c];return b+="]"},b},o=function(){var a=0,b=0,c=0,d="",e={},f=function(a){d+=String.fromCharCode(g(63&a))},g=function(a){if(a<0);else{if(a<26)return 65+a;if(a<52)return a-26+97;if(a<62)return a-52+48;if(62==a)return 43;if(63==a)return 47}throw new Error("n:"+a)};return e.writeByte=function(d){for(a=a<<8|255&d,b+=8,c+=1;b>=6;)f(a>>>b-6),b-=6},e.flush=function(){if(b>0&&(f(a<<6-b),a=0,b=0),c%3!=0)for(var e=3-c%3,g=0;g<e;g+=1)d+="="},e.toString=function(){return d},e},p=function(a){var b=a,c=0,d=0,e=0,f={};f.read=function(){for(;e<8;){if(c>=b.length){if(0==e)return-1;throw new Error("unexpected end of file./"+e)}var a=b.charAt(c);if(c+=1,"="==a)return e=0,-1;a.match(/^\s$/)||(d=d<<6|g(a.charCodeAt(0)),e+=6)}var f=d>>>e-8&255;return e-=8,f};var g=function(a){if(65<=a&&a<=90)return a-65;if(97<=a&&a<=122)return a-97+26;if(48<=a&&a<=57)return a-48+52;if(43==a)return 62;if(47==a)return 63;throw new Error("c:"+a)};return f},q=function(a,b){var c=a,d=b,e=new Array(a*b),f={};f.setPixel=function(a,b,d){e[b*c+a]=d},f.write=function(a){a.writeString("GIF87a"),a.writeShort(c),a.writeShort(d),a.writeByte(128),a.writeByte(0),a.writeByte(0),a.writeByte(0),a.writeByte(0),a.writeByte(0),a.writeByte(255),a.writeByte(255),a.writeByte(255),a.writeString(","),a.writeShort(0),a.writeShort(0),a.writeShort(c),a.writeShort(d),a.writeByte(0);var b=2,e=h(b);a.writeByte(b);for(var f=0;e.length-f>255;)a.writeByte(255),a.writeBytes(e,f,255),f+=255;a.writeByte(e.length-f),a.writeBytes(e,f,e.length-f),a.writeByte(0),a.writeString(";")};var g=function(a){var b=a,c=0,d=0,e={};return e.write=function(a,e){if(a>>>e!=0)throw new Error("length over");for(;c+e>=8;)b.writeByte(255&(a<<c|d)),e-=8-c,a>>>=8-c,d=0,c=0;d|=a<<c,c+=e},e.flush=function(){c>0&&b.writeByte(d)},e},h=function(a){for(var b=1<<a,c=1+(1<<a),d=a+1,f=i(),h=0;h<b;h+=1)f.add(String.fromCharCode(h));f.add(String.fromCharCode(b)),f.add(String.fromCharCode(c));var j=n(),k=g(j);k.write(b,d);var l=0,m=String.fromCharCode(e[l]);for(l+=1;l<e.length;){var o=String.fromCharCode(e[l]);l+=1,f.contains(m+o)?m+=o:(k.write(f.indexOf(m),d),f.size()<4095&&(f.size()==1<<d&&(d+=1),f.add(m+o)),m=o)}return k.write(f.indexOf(m),d),k.write(c,d),k.flush(),j.toByteArray()},i=function(){var a={},b=0,c={};return c.add=function(d){if(c.contains(d))throw new Error("dup key:"+d);a[d]=b,b+=1},c.size=function(){return b},c.indexOf=function(b){return a[b]},c.contains=function(b){return void 0!==a[b]},c};return f},r=function(a,b,c,d){for(var e=q(a,b),f=0;f<b;f+=1)for(var g=0;g<a;g+=1)e.setPixel(g,f,c(g,f));var h=n();e.write(h);for(var i=o(),j=h.toByteArray(),k=0;k<j.length;k+=1)i.writeByte(j[k]);i.flush();var l="";return l+="<img",l+=' src="',l+="data:image/gif;base64,",l+=i,l+='"',l+=' width="',l+=a,l+='"',l+=' height="',l+=b,l+='"',d&&(l+=' alt="',l+=d,l+='"'),l+="/>"};return b}();return c.prototype.createQr=function(a){"string"==typeof a&&(a={data:a}),a.typeNumber||(a.typeNumber=15),a.typeElement||(a.typeElement="createImg"),a.errorCorrectionLevel||(a.errorCorrectionLevel="L"),a.mode||(a.mode="Byte"),a.cellSize||(a.cellSize=2),a.margin||(a.margin=4*a.cellSize);var b=h(a.typeNumber,a.errorCorrectionLevel);switch(b.addData(a.data,a.mode),b.make(),a.typeElement){case"createImg":return b.createImgTag(a.cellSize,a.margin);case"createSvg":return b.createSvgTag(a.cellSize,a.margin);case"createTable":return b.createTableTag(a.cellSize,a.margin);default:throw new Error("Not found typeElement ["+a.typeElement+"}")}},c.prototype.createVCard=function(c){var h=f(c.version),i="",j=h>=4?"":";CHARSET=UTF-8";j="",c.version||(c.version="4.0"),i+="BEGIN:VCARD"+g(),i+="VERSION:"+c.version+g();var k=c.formattedName;if(k||(k="",[c.firstName,c.middleName,c.lastName].forEach(function(a){a&&k&&(k+=" "),k+=a})),i+="FN"+j+":"+d(k)+g(),i+="N"+j+":"+d(c.lastName)+";"+d(c.firstName)+";"+d(c.middleName)+";"+d(c.namePrefix)+";"+d(c.nameSuffix)+g(),c.nickname&&h>=3&&(i+="NICKNAME"+j+":"+d(c.nickname)+g()),c.gender&&(i+="GENDER:"+d(c.gender)+g()),c.birthday&&(i+="BDAY:"+c.birthday+g()),c.anniversary&&(i+="ANNIVERSARY:"+c.anniversary+g()),c.email&&(Array.isArray(c.email)||(c.email=new Array(c.email)),c.email.forEach(function(a){i+=h>=4?"EMAIL"+j+";type=HOME:"+d(a)+g():h>=3&&h<4?"EMAIL"+j+";type=HOME,INTERNET:"+d(a)+g():"EMAIL"+j+";HOME;INTERNET:"+d(a)+g()})),c.workEmail&&(Array.isArray(c.workEmail)||(c.workEmail=new Array(c.workEmail)),c.workEmail.forEach(function(a){i+=h>=4?"EMAIL"+j+";type=WORK:"+d(a)+g():h>=3&&h<4?"EMAIL"+j+";type=WORK,INTERNET:"+d(a)+g():"EMAIL"+j+";WORK;INTERNET:"+d(a)+g()})),c.otherEmail&&(Array.isArray(c.otherEmail)||(c.otherEmail=new Array(c.otherEmail)),c.otherEmail.forEach(function(a){i+=h>=4?"EMAIL"+j+";type=OTHER:"+d(a)+g():h>=3&&h<4?"EMAIL"+j+";type=OTHER,INTERNET:"+d(a)+g():"EMAIL"+j+";OTHER;INTERNET:"+d(a)+g()})),c.logo&&c.logo.url&&(i+=e("LOGO",c.logo.url,c.logo.mediaType,c.logo.base64,h)),c.photo&&c.photo.url&&(i+=e("PHOTO",c.photo.url,c.photo.mediaType,c.photo.base64,h)),c.cellPhone&&(Array.isArray(c.cellPhone)||(c.cellPhone=new Array(c.cellPhone)),c.cellPhone.forEach(function(a){i+=h>=4?'TEL;VALUE=uri;TYPE="voice,cell":tel:'+d(a)+g():"TEL;TYPE=CELL:"+d(a)+g()})),c.pagerPhone&&(Array.isArray(c.pagerPhone)||(c.pagerPhone=new Array(c.pagerPhone)),c.pagerPhone.forEach(function(a){i+=h>=4?'TEL;VALUE=uri;TYPE="pager,cell":tel:'+d(a)+g():"TEL;TYPE=PAGER:"+d(a)+g()})),c.homePhone&&(Array.isArray(c.homePhone)||(c.homePhone=new Array(c.homePhone)),c.homePhone.forEach(function(a){i+=h>=4?'TEL;VALUE=uri;TYPE="voice,home":tel:'+d(a)+g():"TEL;TYPE=HOME,VOICE:"+d(a)+g()})),c.workPhone&&(Array.isArray(c.workPhone)||(c.workPhone=new Array(c.workPhone)),c.workPhone.forEach(function(a){i+=h>=4?'TEL;VALUE=uri;TYPE="voice,work":tel:'+d(c.workPhone)+g():"TEL;TYPE=WORK,VOICE:"+d(c.workPhone)+g()})),c.homeFax&&(Array.isArray(c.homeFax)||(c.homeFax=new Array(c.homeFax)),c.homeFax.forEach(function(a){i+=h>=4?'TEL;VALUE=uri;TYPE="fax,home":tel:'+d(a)+g():"TEL;TYPE=HOME,FAX:"+d(a)+g()})),c.workFax&&(Array.isArray(c.workFax)||(c.workFax=new Array(c.workFax)),c.workFax.forEach(function(a){i+=h>=4?'TEL;VALUE=uri;TYPE="fax,work":tel:'+d(a)+g():"TEL;TYPE=WORK,FAX:"+d(a)+g()})),c.otherPhone&&(Array.isArray(c.otherPhone)||(c.otherPhone=new Array(c.otherPhone)),c.otherPhone.forEach(function(a){i+=h>=4?'TEL;VALUE=uri;TYPE="voice,other":tel:'+d(a)+g():"TEL;TYPE=OTHER:"+d(a)+g()})),[{details:c.homeAddress||{},type:"HOME"},{details:c.workAddress||{},type:"WORK"}].forEach(function(b){i+=a(j,b,h)}),c.title&&(i+="TITLE"+j+":"+d(c.title)+g()),c.role&&(i+="ROLE"+j+":"+d(c.role)+g()),c.organization&&(i+="ORG"+j+":"+d(c.organization)+g()),c.url&&(i+="URL"+j+":"+d(c.url)+g()),c.workUrl&&(i+="URL;type=WORK"+j+":"+d(c.workUrl)+g()),c.note&&(i+="NOTE"+j+":"+d(c.note)+g()),c.socialUrls)for(var l in c.socialUrls)c.socialUrls.hasOwnProperty(l)&&c.socialUrls[l]&&(i+="X-SOCIALPROFILE"+j+";TYPE="+l+";x-user="+d(c.socialUrls[l])+":"+b(l,c.socialUrls[l])+g());return c.source&&(i+="SOURCE"+j+":"+d(c.source)+g()),c.rev&&(i+="REV:"+d(c.REV)+g()),i+="END:VCARD"+g()},c.prototype.createVCardQr=function(a,b){return b.data=this.createVCard(a),this.createQr(b)},new c});